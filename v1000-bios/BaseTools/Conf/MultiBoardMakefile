## @file
#  Common Makefile for project build
#  This file was been auto-generated by GenProjectCfg, please do not modify in here.
#  For buld target "{{CFG_TARGET}}" that defined in [{{CFG_PATH}}].
#
#******************************************************************************
#* Copyright (c) 2013 - 2016, Insyde Software Corp. All Rights Reserved.
#*
#* You may not reproduce, distribute, publish, display, perform, modify, adapt,
#* transmit, broadcast, present, recite, release, license or otherwise exploit
#* any part of this publication in any form, by any means, without the prior
#* written permission of Insyde Software Corporation.
#*
#******************************************************************************

#
# Build options for build targets
#
{{MULTIBOARD_BUILD_OPTIONS}}

#
# Build Targets
#
{{BUILD_TARGET}}: PreBuild
  build -N $(BUILD_OPTIONS)
  $(MAKE) /nologo -f $(OUTPUT_DIR)\MultiBoardMakefile PostBuild
  $(MAKE) /nologo -f $(OUTPUT_DIR)\MultiBoardMakefile MultiBoardPostBuild

cleancache:
  @if exist $(WORKSPACE)\Conf\.cache rmdir $(WORKSPACE)\Conf\.cache /s /q

clean: cleancache
  @if exist $(WORKSPACE)\Build rmdir $(WORKSPACE)\Build /s /q

MultiBoardPostBuild:
### Copy BuildFd to TempFd
  $(MAKE) /nologo -f $(OUTPUT_DIR)\MultiBoardMakefile CopyTempFd
### Configure Phase
# Add Config code in here
## Copy TempFd to TargetFd
  $(MAKE) /nologo -f $(OUTPUT_DIR)\MultiBoardMakefile CopyTargetFd
  
CopyTempFd:
  @echo Copy Build Output to Temporary Output ($(TEMP_FD_DIR)\$(TEMP_FD_FILENAME))
  @if not exist $(TEMP_FD_DIR) mkdir $(TEMP_FD_DIR)
  @copy $(BUILD_FD_DIR)\$(BUILD_FD_FILENAME) $(TEMP_FD_DIR)\$(TEMP_FD_FILENAME)

CopyTargetFd:
  @echo Copy Temporary Output to Target Output ($(TARGET_FD_DIR)\$(TARGET_FD_FILENAME))
  @if not exist $(TARGET_FD_DIR) mkdir $(TARGET_FD_DIR)
  @copy $(TEMP_FD_DIR)\$(TEMP_FD_FILENAME) $(TARGET_FD_DIR)\$(TARGET_FD_FILENAME)
  
PreBuild: cleancache gen_target genfont genlayout clean_var
  @set PACKAGES_PATH=$(PACKAGES_PATH)
  @set PROJECT_PKG=$(PROJECT_PKG)
  @set CHIPSET_PKG=$(CHIPSET_PKG)
  @if exist ProjectPreBuild.bat call ProjectPreBuild.bat $(BUILD_TARGET)

PostBuild:
  @if exist ProjectPostBuild.bat call ProjectPostBuild.bat $(BUILD_TARGET)
  @if exist $(WORKSPACE)\Build\$(PROJECT_PKG)\BuildDuration echo Build time :
  @if exist $(WORKSPACE)\Build\$(PROJECT_PKG)\BuildDuration type $(WORKSPACE)\Build\$(PROJECT_PKG)\BuildDuration

genfont:
!IF "$(PROJECT_PKG)" != ""
  @create_temporary_font_hpk.bat
!ENDIF

genlayout:
!IF "$(PROJECT_PKG)" != ""
  @create_temporary_layout_hpk.bat
!ENDIF

clean_var:
  @if exist $(WORKSPACE)\Build\$(PROJECT_PKG)\$(TARGET_MODE)_$(TOOL_CHAIN)\FV\VarFile rmdir $(WORKSPACE)\Build\$(PROJECT_PKG)\$(TARGET_MODE)_$(TOOL_CHAIN)\FV\VarFile /s /q

gen_target:
  @echo ACTIVE_PLATFORM              = Build/$(PROJECT_PKG)/Project.dsc >  $(WORKSPACE)\Conf\target.txt
  @echo TARGET_ARCH                  = $(ARCH)                          >> $(WORKSPACE)\Conf\target.txt
  @echo TARGET                       = $(TARGET_MODE)                   >> $(WORKSPACE)\Conf\target.txt
  @echo TOOL_CHAIN_CONF              = Conf/tools_def.txt               >> $(WORKSPACE)\Conf\target.txt
  @echo TOOL_CHAIN_TAG               = $(TOOL_CHAIN)                    >> $(WORKSPACE)\Conf\target.txt
  @echo MAX_CONCURRENT_THREAD_NUMBER = $(NUMBER_OF_PROCESSORS)          >> $(WORKSPACE)\Conf\target.txt
  @echo BUILD_RULE_CONF              = Conf/build_rule.txt              >> $(WORKSPACE)\Conf\target.txt
